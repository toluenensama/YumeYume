{% include "nav.html" %}
<!-- hero page -->
{% if not logged_in %}
<header >
    <div class="container col-xxl-8 px-4 py-5">
      <div class="row flex-lg-row-reverse align-items-center g-5 py-5">
        <div class="col-10 col-sm-8 col-lg-6">
          <img src="https://img.freepik.com/free-photo/illustration-anime-city_23-2151779607.jpg" class="d-block mx-lg-auto img-fluid" alt="Welcome Themes" width="700" height="500" loading="lazy">
        </div>
        <div class="col-lg-6">
          <h1 class="display-5 fw-bold text-body-emphasis lh-1 mb-3">Track Your Anime Journey. Discover Your Next Favorite</h1>
          <p class="lead"> Never Forget Another Episode.Organize Your Watchlist, Rate Your Shows, and Join the Anime Community</p>
          <div class="d-grid gap-2 d-md-flex justify-content-md-start">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#SignUpModal">
              Sign Up
            </button>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#SignInModal">
              SIgn In
            </button>
          </div>
        </div>
      </div>
    </div>
   </header>
   <div class="modal fade" id="SignUpModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-theme="dark">
    <div class="modal-dialog bg-body-tertiary modal-dialog-centered rounded-4 border" data-bs-theme="dark">
      <div class="modal-content" data-bs-theme="dark">
        <div class="modal-header bg-body-tertiary text-center">
          <h1 class="modal-title mb-3 px-4 border-bottom-0 fw-bold" id="exampleModalLabel">Sign Up</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body bg-body-tertiary">
          <form class="p-4 p-md-5 rounded-3 bg-body-tertiary" action="{{ url_for('register') }}" method="post">
            {% with messages = get_flashed_messages() %}
            {% if messages %}
              <ul class=flashes style="color: brown;">
              {% for message in messages %}
                <li>{{ message }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          {% endwith %}
              <div class="form-floating mb-3 bg-body-tertiary">
                  <input type="text" class="form-control bg-body-tertiary" id="name" placeholder="Name" name="name" required>
                  <label for="text">Name</label>
                </div>
            <div class="form-floating mb-3 bg-body-tertiary">
              <input type="email" class="form-control bg-body-tertiary" id="floatingInput" placeholder="name@example.com" name="email" required>
              <label for="floatingInput">Email address</label>
            </div>
            <div class="form-floating mb-3 bg-body-tertiary">
              <input type="password" class="form-control bg-body-tertiary" id="floatingPassword" placeholder="Password" name="password" required>
              <label for="floatingPassword">Password</label>
            </div>
            <button class="w-100 btn btn-lg btn-primary" type="submit">Sign up Now </button>
            <hr class="my-4">
            <small class="text-body-secondary">By clicking Sign up, you agree to the terms of use.</small>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="SignInModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-theme="dark">
    <div class="modal-dialog bg-body-tertiary modal-dialog-centered rounded-4 border" data-bs-theme="dark">
      <div class="modal-content" data-bs-theme="dark">
        <div class="modal-header bg-body-tertiary text-center">
          <h1 class="modal-title mb-3 px-4 border-bottom-0 fw-bold text-center" id="exampleModalLabel">Sign In</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body bg-body-tertiary">
          <form class="p-4 p-md-5 rounded-3 bg-body-tertiary" action="{{ url_for('login') }}" method="post">
            {% with messages = get_flashed_messages() %}
            {% if messages %}
              <ul>
              {% for message in messages %}
                <li>{{ message }}</li>
              {% endfor %}
              </ul>
            {% endif %}
          {% endwith %}
          <div class="form-floating mb-3 bg-body-tertiary">
            <input type="email" class="form-control bg-body-tertiary" id="floatingInput" placeholder="name@example.com" name="email" required>
            <label for="floatingInput">Email address</label>
          </div>
            <div class="form-floating mb-3 bg-body-tertiary">
              <input type="password" class="form-control bg-body-tertiary" id="floatingPassword" placeholder="Password" name="password" required>
              <label for="floatingPassword">Password</label>
            </div>
            <button class="w-100 btn btn-lg btn-primary" type="submit">Sign In </button>
            <hr class="my-4">
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% endif %}

    
<div class="container px-4 py-5">
  {% if logged_in: %}
  <button type="button" class="btn btn-primary rounded-5 float-end sticky-top" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="height: 100px;width: 100px;">
    <span class="material-symbols-outlined">
      <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EFEFEF">
        <path d="M450-450H200v-60h250v-250h60v250h250v60H510v250h-60v-250Z"/>
      </svg>
  </button>
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Create Post</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form class="mb-auto" action="{{url_for('post')}}" method="post" enctype="multipart/form-data"> 
            <div class="row justify-content-start">
            <div class="col-3 float-start py-2">
              <span class="material-symbols-outlined float-end g-2">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#EFEFEF">
                  <path d="M440-440ZM120-120q-33 0-56.5-23.5T40-200v-480q0-33 23.5-56.5T120-760h126l74-80h240v80H355l-73 80H120v480h640v-360h80v360q0 33-23.5 56.5T760-120H120Zm640-560v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM440-260q75 0 127.5-52.5T620-440q0-75-52.5-127.5T440-620q-75 0-127.5 52.5T260-440q0 75 52.5 127.5T440-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29Z"/>
                </svg>
                </span>
            </div> 
            <div class="input-group col py-2">
              <input type="file" class="form-control" type="file" name="file" id="inputGroupFile04" aria-describedby="inputGroupFileAddon04" aria-label="Upload">
              <button class="btn btn-outline-secondary" id="inputGroupFileAddon04">
                <span class="material-symbols-outlined">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#EFEFEF">
                  <path d="M440-320v-326L336-542l-56-58 200-200 200 200-56 58-104-104v326h-80ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/></svg>
                </span>
              </button>
            </div>
          </div>
          <div class="input-group mb-3">
            <!-- <span class="input-group-text">With textarea</span> -->
            <textarea class="form-control" name="post_body" aria-label="With textarea"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn">
            <span class="material-symbols-outlined">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#EFEFEF">
                <path d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"/>
              </svg>
          </button>
        </form>
        <!-- <div class="d-grid gap-2 d-md-flex justify-content-md-start">
      </div> -->
        </div>
  </div>
</div>
</div>
{% endif %} 
<!-- Main Content -->
{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            {% for post in all_posts %}
            <div class="card mb-4 shadow-sm">
                <div class="card-body">
                    <!-- Post Header -->
                    <div class="d-flex align-items-center mb-3">
                        <img src="{{ post.author.email | gravatar }}" alt="User Avatar" class="rounded-circle me-2" width="40" height="40">
                        <div>
                            <h6 class="mb-0">{{ post.author.name }}</h6>
                            <small class="text-muted">{{ post.date }}</small>

                        </div>
                    </div>
                    {% if post.anime_tag_name %}
                    <p class="text-success">{{ post.anime_tag_name}}</p>
                    {% endif %}
                    <!-- Post Image -->
                    {% if post.image %}
                    <div class="post-image-container mb-3">
                        <img src="{{ url_for('serve_image', image_id=post.id) }}" alt="Post Image" class="img-fluid rounded">
                    </div>
                    {% endif %}
                                        <!-- Post Content -->
                    <p class="card-text">{{ post.post }}</p>
                    <p class="card-text">
                      <small class="text-muted">{{ post.liked_by.count() }} Likes</small>
                  </p>
                    <!-- Post Actions -->
                    <div class="d-flex justify-content-between">

                      <button id="like-button-{{ post.id }}" class="btn btn-sm btn-danger" onclick="toggleLike({{ post.id }})">
                        {% if current_user in post.liked_by %}
                        <i class="bi bi-heart"></i>  Unlike
                        {% else %}
                        <i class="bi bi-heart-fill"></i> Like
                        {% endif %}
                    </button>
                        <button class="btn  btn-sm">
                            <i class="bi bi-chat"></i> Comment
                        </button>
                        <button class="btn btn-sm">
                            <i class="bi bi-share"></i> Share
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
{% include "footer.html" %}
    
